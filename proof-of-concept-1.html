<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<script src="lib/typescriptServices.js"></script>

<script type="text/typescript" id="source">
    class A {
        private _property: string;
        get property(): string {
            return this._property;
        }

        set property(value: string) {
            this._property = value;
        }
    }

    var a = new A();
    a.property = 1;
</script>
<script type="text/javascript">

    function getSrc(){
        return document.getElementById("source").innerText;
    }

    function output(o){
        console.log(o);
    }

    const logPrefix = "TS:";
    var languageServiceHost = {
        files : {},
        log : function(msg) { console.log(logPrefix+msg); },
        trace: function(msg) { console.log(logPrefix+" [TRACE] "+msg); },
        error: function(msg) {console.error(logPrefix+msg);},
        getCompilationSettings: function() { return ts.getDefaultCompilerOptions; },
        getScriptIsOpen: function(filename) { return true; },
        getCurrentDirectory : function() {return "";},
        getDefaultLibFileName : function() { return "lib.d.ts";},
        getScriptVersion : function(filename) { return this.files[filename].version.toString(); },
        getScriptSnapshot : function(filename) { console.info("getting snapshot for "+filename);return this.files[filename].file;},
        getScriptFileNames : function() {
            var names = [];
            for(var f in this.files){
                names.push(f);
            }
            return names;
        },
        addFile: function(filename, body) {
            var previousVersion = 0;
            if(this.files[filename])
                previousVersion = this.files[filename].version;
            this.files[filename] = {
                version : previousVersion+1,
                file: ts.ScriptSnapshot.fromString(body)
            };
            return this.files[filename];
        }
    };

    var languageService = ts.createLanguageService(languageServiceHost, ts.createDocumentRegistry());

    // load scripts

    var oReq = new XMLHttpRequest();

    oReq.onload = function(e) {
        var response = oReq.responseText; // not responseText
        languageServiceHost.addFile("lib.d.ts", response);
        console.log("base library loaded");

        languageServiceHost.addFile("userscript.ts", getSrc());
        output(languageService.getSemanticDiagnostics("userscript.ts"));
        output(languageService.getEmitOutput("userscript.ts"));

    }
    oReq.open("GET", "lib/lib.d.ts");
    oReq.send();

</script>

</body>
</html>